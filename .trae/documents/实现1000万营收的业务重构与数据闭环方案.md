## 项目基础数据需求清单

- 收入：最近12个月按产品线/渠道/客户类型的月度收入、客单价、退款率
- 成本：固定成本（人力/云资源/第三方API）与可变成本（每次调用/发货/营销），按月分解
- 用户：DAU/MAU、新增、留存、流失率、回流率，分层（新客/活跃/高价值）
- 漏斗：流量→到达→核心行为（如生成/导出）→注册/付费的转化率、平均时长
- 获客：各渠道投放额、点击/到达/转化、CAC、回本周期
- 价盘：各定价档位的占比、折扣策略、生效时段与弹性
- LTV：按用户分层的ARPU/ARPPU、复购率与生命周期长度

## 当前代码能力综述

- 技术栈：Next.js(App Router)+React+TS+Tailwind；服务端API路由完备
- 业务：核心为“AI卡片生成/导出”，尚未接入支付、订单、用户认证模块
- 监控：已有自研埋点接口`counter/gauge/observe`与统一日志输出，可用于行为与性能采样
- 关键埋点位置：
  - `src/interfaces/http/controllers/GenerateController.ts:21` 生成失败（校验）计数
  - `src/interfaces/http/controllers/GenerateController.ts:29` 成功延迟直方图（含`variant`标签）
  - `src/interfaces/http/controllers/GenerateController.ts:30` 生成成功计数
  - `src/interfaces/http/controllers/GenerateController.ts:37` 失败延迟直方图
  - `src/interfaces/http/controllers/GenerateController.ts:40` 生成失败计数（含原因）
  - `src/application/usecases/GenerateCardUseCase.ts:34` 缓存命中/未命中计数
  - `src/application/usecases/GenerateCardUseCase.ts:61` 限流计数
  - `src/application/usecases/GenerateCardUseCase.ts:69` 文案生成耗时
  - `src/application/usecases/GenerateCardUseCase.ts:84` AI处理耗时（含`model`标签）
  - `src/application/usecases/GenerateCardUseCase.ts:91` 图片转换耗时
  - 指标函数定义：`src/shared/lib/metrics.ts:28/34/40`

## 数据采集与仓库设计

- 统一ID：接入认证（如NextAuth+OAuth/Email）生成稳定`user_id`，事件统一关联
- 事件字典：`page_view`、`click_generate`、`generate_success`、`export_zip`、`signup`、`pay_success`、`refund`
- 收入事件：`order_created`/`order_paid`含`amount/currency/plan/channel/campaign`
- 成本事件：AI调用单价、短信/邮件单价、云转码单次成本，按事件落账
- 数据层：Postgres/Turso数据仓库，分区表（events、orders、costs、users、daily_kpi），保留原始与汇总层
- 日志管道：现有JSON行日志对接ClickHouse或ELK，用于快速聚合（性能与行为）

## 转化漏斗与埋点实现

- 漏斗定义：`流量→到达→互动→生成→导出→注册→付费`，每步事件与属性清单
- 标准属性：`user_id/session_id/referrer/campaign/device/geo`与`variant/model`
- A/B实验：保持`variant`标签贯通，支持CTA文案与流程差异对比

## 收入与成本度量

- 收入：按`订单/订阅`聚合`MRR/ARR/AOV/ARPPU`，拆解渠道贡献与转化率
- 成本：AI模型、图片转换、缓存/带宽、短信/邮件的单位成本×事件次数
- 单客经济：`CAC/LTV/Payback`按分层计算，目标`LTV≥3×CAC`，回本≤3月

## 三级产品体系落地

- 引流品：免费生成+低配导出，强化分享组件引流
- 利润品：高清导出、批量导出、品牌模板库、团队协作
- 战略品：企业版API/工作流自动化（批处理、队列、权限、审计）
- 定价：阶梯版+按量计费结合；动态定价与限时折扣由规则引擎驱动

## 增长引擎实现

- 裂变：推荐奖励（双向券/额度）、社群分销（唯一邀请码与结算）
- 动态定价：基于`需求强度/转化概率/成本`的区间折扣与实时提示
- 自动化漏斗：EDM（SendGrid）、短信（Twilio/国内通道）、Push（Web Push），基于分层的序列触达

## 实施路线图

- 0–3月：认证与事件统一、支付与订单接入、日志管道、MVP看板（核心KPI与漏斗）
- 4–6月：产品分层与定价上线、渠道拓展与裂变、自动化运营、A/B实验闭环
- 7–12月：企业版与API商业化、生态合作（模板市场/插件）、数据驱动提效与扩张

## 风险控制与预警

- 指标阈值：`CAC、流失率、API失败率、限流比例、延迟P95`预警
- 敏捷迭代：月度复盘+周度看板滚动优化
- 资金池：预期收入的20%作为应急与投放缓冲

## 交付物清单

- 事件字典与埋点清单、数据仓库DDL与ETL流程、KPI仪表盘、A/B框架与报表
- 收入/成本模型与单客经济分析模板、定价与营销自动化规则库

请确认是否按此方案执行，并提供“项目基础数据需求清单”中的历史数据，以便进行精准测算与方案定制。
