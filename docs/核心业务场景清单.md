# 核心业务场景清单（100%覆盖要求）

## 金融域

- 债券定价：正常/极值参数、错误输入；用例审计追踪
- 期权定价（BS）：call/put 分支、负价容忍与数值稳定性
- 股票指标：均值/波动率计算，空/异常序列处理

## 卡片生成

- 并行执行：文案与AI并行总耗时约等于较慢者
- 占位图降级：AI失败时回退并成功
- 缓存：命中与未命中路径、度量上报

## 导出

- 空导出校验：无图片返回 400
- 成功导出：zip 格式与头部断言
- 幂等：`x-idempotency-key` 相同请求返回一致结果
- 限流：IP维度触发 429

## HTTP 契约与错误

- `jsonOk/jsonError/jsonErrorFromAppError` 模型一致性
- OpenAPI 路由与错误模型存在性
- CSRF/RBAC：禁止访问与角色校验（admin/user）

## 监控与指标

- `metrics` 计数/仪表/直方图工作与摘要
- `analytics` 埋点携带 variant/ip

## 性能度量（基线）

- API 吞吐与 p95 延迟
- worker 内存峰值与均值
- 启动时延（dev/start）

> 对应测试文件：`tests/*.test.ts` 已覆盖以上场景，新增 `tests/openapi.test.ts`、`tests/finance.usecase.test.ts`、`tests/export-controller.test.ts`（幂等）。
