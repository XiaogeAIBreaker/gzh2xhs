# 重构路线图与优先级依赖

## 原则
- 优先保证业务连续性与风险可控；小步快跑、逐步交付可验证增量。
- 按领域与依赖关系推进；每一步具备回滚与观测手段。

## 阶段划分与产出
- 阶段一：评估与标准化（当前进行）
  - 产出：架构总览、代码与架构标准、测试策略、路线图。
- 阶段二：分层与 BFF 落地
  - 目标：在前端与 BFF 之间建立清晰契约；抽离应用层与领域层；引入兼容适配器。
  - 依赖：契约包与 OpenAPI；日志/指标/追踪基础设施。
  - 产出：分层改造的首批模块（例如生成/导出/Finance）。
- 阶段三：契约统一与跨服务对齐
  - 目标：统一 Node 与 Python 服务的 API/事件契约；建立 Diff 门禁。
  - 依赖：契约生成与校验工具链；CI 门禁。
  - 产出：契约版本管理、客户端生成与联调用例。
- 阶段四：数据访问与事务一致性
  - 目标：仓储模式统一、事务边界明确；并发冲突与一致性策略。
  - 依赖：数据库迁移框架与回滚脚本；测试环境。
  - 产出：迁移与基准测试报告、关键场景一致性用例。
- 阶段五：性能与安全加固
  - 目标：达成 p95 与吞吐目标；消除高危漏洞与不合规依赖。
  - 依赖：基准/压测工具、SAST/DAST、依赖与镜像扫描。
  - 产出：性能对比报告、安全扫描报告与整改清单。
- 阶段六：部署与运维指南完善
  - 目标：完善 Helm/Compose 与回滚演练；告警阈值与应急流程。
  - 产出：部署手册、运行手册与演练记录。

## 模块与优先级（示例）
- P0：跨端公共契约（DTO/错误码/事件 Schema）、BFF 网关、Finance 核心用例与风控路径。
- P1：生成与导出模块、缓存与并发控制、日志与可观测性统一。
- P2：次要业务模块、工具与脚手架优化、文档与示例完善。

## 依赖关系与风险
- 契约包是分层与跨服务对齐的前置；需先落地并在 CI 强制校验。
- 数据迁移与性能压测需在隔离环境完成；禁止对生产直接施压。
- 回滚与灰度机制必须在每个里程碑演练并通过核验。

## 验收与度量
- 每阶段提供 PR、报告与工件链接；质量门禁全部通过方可合并。
- 提供覆盖率与性能趋势图；对关键 SLO 持续跟踪与复盘。
