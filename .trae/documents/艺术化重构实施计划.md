## 概览

- 在不破坏功能的前提下，为 UI 层进行艺术化重构与风格统一；逻辑/领域层维持现有 API 与行为。
- 使用现有工具链（Next 14、Tailwind、Vitest、ESLint/Prettier）实现 4 空格缩进、诗意命名、ASCII 分隔注释、8px 网格与测试覆盖率≥95%。

## 约束与假设

- 保留对外接口与文件结构的可预期性，避免大范围破坏性重命名（重点在 UI 层实施命名风格）。
- 测试框架优先沿用 Vitest（已配置 coverage≥95），如需强制 Jest，可在最终阶段引入兼容桥或切换。

## 工具与配置

- 代码风格：
    - Prettier 已设 `tabWidth: 4`；补充 ESLint 规则以提升可读性与节奏：`padding-line-between-statements`（块间空行），`max-lines-per-function`（约束核心函数规模），`complexity` 维持现有。
    - 插入统一 ASCII 艺术分隔注释模板（示例）：
        ```
        /*******************************
         * 色彩处理模块
         *******************************/
        ```
- 命名规范（“诗意命名法”执行策略）：
    - 变量：具象名词（如 `crimsonSunset`、`glassEcho`）；函数：动宾短语（如 `paintColorGradient()`）。
    - 范围控制：UI 组件、样式相关工具与文案服务允许改名；领域、接口、容器、配置维持原名，仅增注释标记。
- 布局系统：
    - Tailwind 统一 8px 网格：只使用间距类 `p-2/p-4/p-6`、`m-2/m-4/m-6`、`gap-2/gap-4` 等（对应 8/16/24px）。
    - 清理非 8 的倍数（如 `gap-3` 改为 `gap-2` 或 `gap-4`）。

## 代码重构范围

- UI 层：`src/components`、`src/app` 下页面与布局组件，实施命名、注释分隔、网格对齐与节奏空白。
- 逻辑层：`application/`、`domain/`、`lib/`、`interfaces/http/` 不做破坏性改名，仅加模块分隔注释与少量节奏空白。

## 结构组织

- 黄金分割点定位：
    - 写入简易统计脚本（仅内部使用）计算文件总行数，核心导出（如默认组件、主要 useCase）放置于约 61.8% 行位置，辅助函数按“视觉重量”前后分布。
- if/else 对称化：
    - 对匹配分支填充对齐行数（注释与空白行辅助达成），保证镜像缩进与相同行量。
- 斐波那契节奏：
    - 相关功能块以 1、1、2、3、5 行空白进行分组，优先在 UI 组件内使用，逻辑层谨慎采用。

## 主题与编辑器

- VS Code 方案：
    - `settings.json`：`"editor.fontFamily": "Fira Code", "editor.fontLigatures": true`。
    - `workbench.colorCustomizations` 与 `editor.tokenColorCustomizations` 指定：`comments: #78909C`、`strings: #EF5350`、`keywords: #7E57C2`。
    - 提供完整 `json` 主题片段供导入。
- Vim 方案：
    - 提供 `colorscheme` 片段：
        ```vim
        hi Comment  guifg=#78909C ctermfg=244
        hi String   guifg=#EF5350 ctermfg=203
        hi Keyword  guifg=#7E57C2 ctermfg=98
        set guifont=Fira\ Code:h14
        set font=Fira\ Code
        ```
- IntelliJ 方案：
    - 交付 `.icls` 主题文件，映射相同颜色并启用连字（Editor → Font → Fira Code → Ligatures）。

## 测试与质量

- 覆盖率：沿用 `vitest.config.ts` 的 `v8` 覆盖并将阈值维持 ≥95%；新增 UI 层的行为测试与快照测试，保证重构不破坏交互（如 Toast 组件展示/关闭）。
- 如需 Jest：可添加 `jest` 与 `ts-jest`，共享 `tsconfig`，测试文件兼容迁移；但考虑现有 Vite/Next 集成，优先保持 Vitest。

## 可视化与报告

- 代码热图：
    - 生成依赖图与行数热度（基于 `dependency-cruiser` + `cloc`/`wc -l`），输出 `CSV/JSON`。
    - 提供 SourceInsight 导入指引；如需本地生成 SI 项目图，给出映射脚本与示意图。

## 跨平台换行

- 添加 `.gitattributes`：
    - ```
      * text=auto eol=lf
      ```
    - 保证跨平台换行一致性。

## 交付物

- 更新后的 UI 源码（诗意命名、ASCII 注释、8px 网格）。
- VS Code/Vim/IntelliJ 三平台主题配置文件。
- 覆盖率报告（text、html、lcov）。
- 代码热图 CSV/JSON 与可视化指引。
- `.gitattributes` 文件。

## 实施步骤

- 阶段 1（基线）：审计组件与样式，确定改名黑/白名单；补充 ESLint 规则与注释模板。
- 阶段 2（UI 艺术化）：逐组件实施命名、注释与网格；示范从 `Toast.tsx` 着手（如 `toastCloseTimerDelay → crimsonSunsetDelay`，`showToast → whisperToast()`）。
- 阶段 3（结构节奏）：核心导出落位黄金分割点；对称化条件分支；应用斐波那契空白节奏。
- 阶段 4（主题与文档）：交付三平台主题配置；编写采用指南。
- 阶段 5（测试与报告）：补齐行为/快照测试；生成覆盖与热图报告；最终审阅。

## 风险与回滚

- 命名改动可能影响外部引用：限制在 UI 层并通过 re-export 或保持原导出名以兼容。
- 结构节奏与黄金分割属审美增强：若与团队习惯冲突，提供开关与保留原版分支。
