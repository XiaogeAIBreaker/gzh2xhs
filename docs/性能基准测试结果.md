# 性能基准测试结果

## 方法

- 脚本：`scripts/perf/basic-bench.mjs`
- 指标：`p50/p90/p95/p99`、`avg`、`ok/fail`、并发数
- 场景：本地 dev（Node 20）、并发 4、时长 5s；生成接口需配置 AI 密钥

## 基线（示例，无 AI 密钥）

```json
{
    "url": "/api/openapi",
    "durationMs": 3000,
    "concurrency": 4,
    "total": 606,
    "ok": 0,
    "fail": 606,
    "p50": 17,
    "p90": 24,
    "p95": 32,
    "p99": 68,
    "avg": 20
}
```

说明：示例为 GET/POST 不匹配导致失败，仅用于说明输出格式。

## 优化点对应指标

- 图片转换：移除固定等待，非 emoji 走 sharp（期望 p95 降低 ≥20%）
- 并发：截图并发参数化（期望吞吐提升 ≥30%）
- 调用：AI 超时+重试（失败率降低，稳态延迟改善）
- 缓存：命中率提升（减少重复生成延迟）

## 采集与核验

- 通过 `logger` 输出的 metrics JSON 行验证：`api_generate_latency_ms`、`image_convert_time_ms` 等
- 建议在有密钥的 `staging/prod` 环境分别跑基准并记录对比
