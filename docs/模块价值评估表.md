# 模块价值评估表

本评估依据分层清晰度、耦合度、稳定性、复用度、复杂度、变更频率、可替换性七项指标，分级为 A（优质资产）、B、C、D（不良资产）。

## 结论摘要

- 核心优质资产（A）：`src/domain/finance/pricing/*`、`src/application/finance/PricingUseCase.ts`、`src/lib/http.ts`、`src/shared/lib/cache.ts`
- 重点提升（B）：`src/interfaces/http/controllers/*`（验证与追踪良好，但幂等/限流需统一策略）
- 风险资产（C）：`src/shared/lib/*` 中重复封装（`redis`/`image-converter`/`rateLimiter` 与 `src/lib/*` 交叉）
- 不良资产（D）：跨层耦合与潜在循环依赖的文件（依赖图告警项，需按 `docs/deps.json` 清算）

## 明细打分

### 领域层（Domain）

- `src/domain/finance/pricing/*`：A（纯函数、确定性强、接口稳定、复用度高、复杂度可控）
- `src/domain/finance/errors.ts`：A（错误集中管理，边界清晰）

### 应用层（Application）

- `src/application/finance/PricingUseCase.ts`：A（审计与编排清晰，依赖稳定）
- `src/application/usecases/GenerateCardUseCase.ts`：B（依赖外部提供方，需增强失败与超时策略）

### 接口层（Interface / Controllers）

- `src/interfaces/http/controllers/GenerateController.ts`：B（Zod 校验完善；建议增加幂等与限流）
- `src/interfaces/http/controllers/ExportController.ts`：B（校验与错误封装合理；建议加入幂等与限流）
- 金融控制器 `src/interfaces/http/controllers/finance/*.ts`：A/B（校验严格、指标追踪完善；建议统一幂等策略）

### 基础设施（Infrastructure）

- `src/shared/lib/cache.ts`：A（LRU 设计简单可靠，可作为幂等/防抖缓存）
- `src/shared/lib/rateLimiter.ts`：B（具备内存/Redis 双路；需在控制器层统一接入）
- `src/infrastructure/workers/financePool.ts`：B（适用于重计算；需资源上限与监控完善）

### 共享/工具（Shared/Lib）

- `src/lib/http.ts`：A（统一 JSON 响应与错误结构，利于契约一致性）
- `src/shared/lib/*` 与 `src/lib/*`：C（存在重复封装与交叉职责，建议收敛与统一）

## 处置建议

- 护城河建设：在控制器层接入统一幂等（`x-idempotency-key` + `cache`）与限流（IP/用户维度）。
- 清算技术债：以 `docs/deps.json` 为依据，移除跨层耦合、消除循环依赖，统一 `lib` 与 `shared/lib` 的重复模块。
- 稳定接口：为核心路由与用例建立契约测试（OpenAPI/领域不变式），并纳入 CI 质量门。

## 度量来源

- 依赖健康度：`docs/deps.json`
- 复杂度与覆盖：Vitest 覆盖报告与函数/分支阈值
- 变更频率：Git 历史（后续引入变更热度热力图对齐 `docs/code-heatmap.*`）
